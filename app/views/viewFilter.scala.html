@(filter: Filter)

@import helper._
@import play.libs.Json
@import services.TagsService
@main("Todo list") {

@if(filter == null) {
  <h3>Showing all objects</h3>
} else {
  <h3>Showing @filter.name</h3>
  <select multiple id="tags-summary"></select>
}
<div style="clear: both" />
<hr/>

<div id="notes"></div>

<div style="width: 15em" class="card">
    <h2>Add a new note</h2>

    <input type="text" id="newPayload" placeholder="Payload" style="width: 97%"/>
    <select multiple id="newTags"></select> <br/>
    <input type="button" id="addBtn" value="Add" />
</div>

<script src="@routes.Assets.at("javascripts/NoteCard.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() {


        var numbers = new Bloodhound({
  datumTokenizer: function(d) { return Bloodhound.tokenizers.whitespace(d.num); },
  queryTokenizer: Bloodhound.tokenizers.whitespace,
  local: [
    { num: 'one' },
    { num: 'two' },
    { num: 'three' },
    { num: 'four' },
    { num: 'five' },
    { num: 'six' },
    { num: 'seven' },
    { num: 'eight' },
    { num: 'nine' },
    { num: 'ten' }
  ]
});
console.log(numbers);
// initialize the bloodhound suggestion engine
numbers.initialize();
console.log(numbers);
        $('#newPayload').typeahead(null, {source: numbers.ttAdapter()});


        //setupTagsBox($('#newTags'));

        $("#addBtn").on("click", function () {
            addNote($("#newPayload").val(), getTags(), function(newObject) {
                clearInput();
                appendObject (newObject);
            });
        });

        @if(filter == null) {
            loadAllObjects(showObjects);
        } else {
            var tags = @Html(Json.stringify(Json.toJson(filter.tags)));

            loadObjectsInFilter(@filter.id, showObjects)
            setupTagsBox($("#tags-summary"), {
                onAddTag: function (tag) {
                    addTagToFilter(@filter.id, tag.name);
                },
                onRemoveTag: function (tag) {
                    removeTagFromFilter(@filter.id, tag.name);
                },
            });

            console.log(tags);
            $("#tags-summary").tagsinput("addAll", tags);

            /*$("#tags-summary").tagsInput({
                onAddTag: function (tagName) {
                    addTagToFilter(@filter.id, tagName, function () {
                        loadObjectsInFilter(@filter.id, showObjects)
                    });
                },
                onRemoveTag: function (tagName) {
                    removeTagFromFilter(@filter.id, tagName, function () {
                        loadObjectsInFilter(@filter.id, showObjects)
                    });
                }
            });*/
            //$("#tags-summary").importTags(tagsToLoad.join(","));
        }
    });

    function showObjects(objects) {
        $("#notes").html("");
        $.each(objects, function(i, obj) {
            appendObject(obj);
        });
    }

    function appendObject(note) {
        var card = new NoteCard(note, function (noteId) {
            removeNote(noteId, function() {
                $("#note-" + noteId).remove();
            });
        });
        card.attr("id", "note-" + note.id);
        $("#notes").append(card);

        $.each(card.children("[tag-data]"), function (i, input) {
            /*$(this).tagsInput({
                onAddTag: function (tagName) {
                  addTagToNote(note.id, [tagName]);
                },
                onRemoveTag: function (tagName) {
                    removeTagFromNote(note.id, tagName);
                }
            });
            $(this).importTags($(this).attr("tag-data"));*/
        });
    }


    function getTags() {
        return $("#newTags").tagsinput("filteredItems");
    }

    function clearInput() {
        $("#newPayload").val("");
        $("#newTags").tagsinput('removeAll');
    }
</script>

}